---
import { Image } from "astro:assets";
import { getCollection, render } from "astro:content";
import Layout from "~/layouts/Layout.astro";
import DownloadWithEmail from "~/components/DownloadWithEmail.astro";
import type { CollectionEntry } from "astro:content";
import type { z } from "astro/zod";
import { DownloadLoaderSchema } from "~/loaders/contentful/schemas";

type DownloadEntry = CollectionEntry<"downloads"> & {
  data: z.infer<typeof DownloadLoaderSchema>;
};

export async function getStaticPaths() {
  const downloads = await getCollection("downloads");
  return downloads.map((download) => ({
    params: { id: download.id },
    props: { download },
  }));
}

const { download } = Astro.props as { download: DownloadEntry };
const { Content } = await render(download);
---

<Layout
  title={`${download.data.title} â€” Critical Systems Analysis`}
  description={download.data.description}
>
  <div class="mx-auto max-w-5xl px-6 pb-12 lg:px-8">
    <div
      class="my-8 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between md:mt-24 md:mb-12"
    >
      <div class="flex-1">
        {download.data.date && (
          <time
            class="block text-lg font-semibold tracking-wide text-blue-500 uppercase"
            datetime={download.data.date.toISOString()}
          >
            {
              download.data.date.toLocaleDateString("en-US", {
                year: "numeric",
                month: "long",
              })
            }
          </time>
        )}
        <h1
          class="text-primary-100 mt-2 text-4xl font-bold tracking-tight md:text-5xl"
        >
          {download.data.title}
        </h1>
      </div>
      {
        download.data.pdf && (
          <div class="hidden sm:block">
            <DownloadWithEmail 
              pdfUrl={download.data.pdf} 
              title={download.data.title}
              buttonClass="text-primary-200 cursor-pointer rounded-full bg-blue-600 px-6 py-3 text-center font-semibold hover:bg-blue-700"
            />
          </div>
        )
      }
    </div>
    <Image
      src={download.data.heroImage.src}
      class="mb-8 aspect-square w-full rounded-md object-cover sm:aspect-video"
      alt={download.data.heroImage.alt}
      inferSize={true}
    />
    <article
      class="prose lg:prose-lg text-primary-400 prose-headings:text-primary-100 prose-a:text-blue-500 prose-strong:text-primary-300 prose-tr:border-primary-600 prose-img:w-full max-w-none"
    >
      <Content />
    </article>
    
    <!-- Training Details Section -->
    <div class="mt-12 grid gap-8 md:grid-cols-2">
      <div class="bg-primary-800 border-primary-700 rounded-lg border p-6">
        <h2 class="text-primary-100 text-xl font-semibold">Training Overview</h2>
        <ul class="text-primary-400 mt-4 space-y-3">
          <li class="flex items-start gap-3">
            <span class="text-primary-100 mt-1 size-5 shrink-0 rounded-full bg-blue-600 p-1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-full w-full fill-current">
                <path fill-rule="evenodd" d="M19.916 4.626a.75.75 0 0 1 .208 1.04l-9 13.5a.75.75 0 0 1-1.154.114l-6-6a.75.75 0 0 1 1.06-1.06l5.353 5.353 8.493-12.74a.75.75 0 0 1 1.04-.207Z" clip-rule="evenodd"/>
              </svg>
            </span>
            <span>Comprehensive curriculum covering key safety standards</span>
          </li>
          <li class="flex items-start gap-3">
            <span class="text-primary-100 mt-1 size-5 shrink-0 rounded-full bg-blue-600 p-1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-full w-full fill-current">
                <path fill-rule="evenodd" d="M19.916 4.626a.75.75 0 0 1 .208 1.04l-9 13.5a.75.75 0 0 1-1.154.114l-6-6a.75.75 0 0 1 1.06-1.06l5.353 5.353 8.493-12.74a.75.75 0 0 1 1.04-.207Z" clip-rule="evenodd"/>
              </svg>
            </span>
            <span>Expert-led sessions with industry professionals</span>
          </li>
          <li class="flex items-start gap-3">
            <span class="text-primary-100 mt-1 size-5 shrink-0 rounded-full bg-blue-600 p-1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-full w-full fill-current">
                <path fill-rule="evenodd" d="M19.916 4.626a.75.75 0 0 1 .208 1.04l-9 13.5a.75.75 0 0 1-1.154.114l-6-6a.75.75 0 0 1 1.06-1.06l5.353 5.353 8.493-12.74a.75.75 0 0 1 1.04-.207Z" clip-rule="evenodd"/>
              </svg>
            </span>
            <span>Practical exercises and real-world case studies</span>
          </li>
        </ul>
      </div>
      
      <div class="bg-primary-800 border-primary-700 rounded-lg border p-6">
        <h2 class="text-primary-100 text-xl font-semibold">Who Should Attend</h2>
        <ul class="text-primary-400 mt-4 space-y-3">
          <li class="flex items-start gap-3">
            <span class="text-primary-100 mt-1 size-5 shrink-0 rounded-full bg-blue-600 p-1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-full w-full fill-current">
                <path fill-rule="evenodd" d="M19.916 4.626a.75.75 0 0 1 .208 1.04l-9 13.5a.75.75 0 0 1-1.154.114l-6-6a.75.75 0 0 1 1.06-1.06l5.353 5.353 8.493-12.74a.75.75 0 0 1 1.04-.207Z" clip-rule="evenodd"/>
              </svg>
            </span>
            <span>Safety engineers and managers</span>
          </li>
          <li class="flex items-start gap-3">
            <span class="text-primary-100 mt-1 size-5 shrink-0 rounded-full bg-blue-600 p-1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-full w-full fill-current">
                <path fill-rule="evenodd" d="M19.916 4.626a.75.75 0 0 1 .208 1.04l-9 13.5a.75.75 0 0 1-1.154.114l-6-6a.75.75 0 0 1 1.06-1.06l5.353 5.353 8.493-12.74a.75.75 0 0 1 1.04-.207Z" clip-rule="evenodd"/>
              </svg>
            </span>
            <span>Systems engineers and developers</span>
          </li>
          <li class="flex items-start gap-3">
            <span class="text-primary-100 mt-1 size-5 shrink-0 rounded-full bg-blue-600 p-1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-full w-full fill-current">
                <path fill-rule="evenodd" d="M19.916 4.626a.75.75 0 0 1 .208 1.04l-9 13.5a.75.75 0 0 1-1.154.114l-6-6a.75.75 0 0 1 1.06-1.06l5.353 5.353 8.493-12.74a.75.75 0 0 1 1.04-.207Z" clip-rule="evenodd"/>
              </svg>
            </span>
            <span>Quality assurance professionals</span>
          </li>
        </ul>
      </div>
    </div>

    <!-- Contact Section -->
    <div
      class="bg-primary-800 border-primary-700 mt-12 flex flex-col rounded-lg border p-8 sm:flex-row sm:items-center sm:justify-between"
    >
      <div>
        <h2
          class="text-primary-100 text-2xl font-bold tracking-tight text-balance"
        >
          Interested in this training?
        </h2>
        <p
          class="text-primary-400 mt-2 max-w-prose leading-relaxed text-pretty sm:text-lg"
        >
          Contact us to learn more about our training programs and how they can benefit your organization
        </p>
      </div>
      <a
        class="text-primary-100 mt-4 inline-block cursor-pointer rounded-full bg-blue-600 px-6 py-3 text-center font-semibold hover:bg-blue-700 sm:mt-0"
        href="/contact/"
      >
        Contact us
      </a>
    </div>
  </div>
</Layout>
